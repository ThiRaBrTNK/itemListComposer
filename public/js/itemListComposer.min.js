!function(e){e.fn.itemListComposer=function(t){var i=e.extend({itemSource:".source",itemReceiver:".receiver",itemReceiverOrderable:!0,item:"li",selectItem:".select",selectAllItems:".select-all",deselectItem:".deselect",deselectAllItems:".deselect-all",shiftUpButton:".order-up",shiftDownButton:".order-down",acceptorTemplate:"#acceptor",acceptorClass:"acceptor",selectedClass:"selected",draggedClass:"dragged",droppableClass:"droppable",onSelect:function(){},onDeselect:function(){}},t);return this.each(function(){function t(t,s){if(s.is(i.itemSource)||s.is(i.itemReceiver)&&!i.itemReceiverOrderable){var r=s.clone(!0);r.append(r.append(t).find(i.item).sort(function(t,i){return e(t).text().toUpperCase().localeCompare(e(i).text().toUpperCase())})),s.replaceWith(r),o(t),i.onDeselect(t)}else s.append(t),o(t),i.onSelect(t);d=e(R).find(i.itemSource),m=e(R).find(i.itemReceiver)}function s(t){var s=e(t).prev();s.hasClass(i.selectedClass)||s.before(t)}function r(t){var s=e(t).next();s.hasClass(i.selectedClass)||s.after(t)}function a(e){e.find("."+i.acceptorClass).remove()}function n(){return g.clone()}function o(t){t.each(function(){var t=D,s=x,r=e(this).parents(i.itemSource);r.length||(t=x,s=D);for(var a in t)e(this).off(a);for(var a in s)e(this).on(a+".itemListComposer",D[a])})}function c(e){var t=e.parents(i.itemSource);return t.length||(t=e.parents(i.itemReceiver)),t}var l,d=e(this).find(i.itemSource),m=e(this).find(i.itemReceiver),f=e(this).find(i.selectItem),p=e(this).find(i.selectAllItems),C=e(this).find(i.deselectItem),h=e(this).find(i.deselectAllItems),u=e(this).find(i.shiftUpButton),v=e(this).find(i.shiftDownButton),g=e(e(this).find(i.acceptorTemplate).get(0).content),R=this,L=null,b=e([]);d.add(m).add(d.find(i.item)).add(m.find(i.item)).add(f).add(C).add(p).add(h).add(u).add(v).off(".itemListComposer");var x={},D={"dragover.itemListComposer":function(t){t.preventDefault();var s=t.originalEvent.pageY-e(this).offset().top,r=e(this).outerHeight()/2;i.itemReceiverOrderable&&(s>r||e(this).prev().hasClass(i.acceptorClass)?s>r&&!e(this).next().hasClass(i.acceptorClass)&&(a(m),e(this).after(n())):(a(m),e(this).before(n())))}};d.append(d.find(i.item).sort(function(t,i){return e(t).text().toUpperCase().localeCompare(e(i).text().toUpperCase())})),i.itemReceiverOrderable||m.append(m.find(i.item).sort(function(t,i){return e(t).text().toUpperCase().localeCompare(e(i).text().toUpperCase())})),o(m.find(i.item)),d.add(m).find(i.item).on("click.itemListComposer",function(t){if(t.shiftKey&&void 0!==l){var s=Math.min(e(this).index(),l.index()),r=Math.max(e(this).index(),l.index()),a=e(this).siblings().slice(s,r);a.add(this).addClass(i.selectedClass)}else e(this).toggleClass(i.selectedClass);l=e(this)}).on("dragstart.itemListComposer",function(t){var s=c(e(this));b=s.find("."+i.selectedClass).add(e(this)),b.addClass(i.draggedClass+" "+i.selectedClass);var r=b.map(function(){return this.innerText}).get().join(", ");t.originalEvent.dataTransfer.setData("text/plain",r)}).on("dragend.itemListComposer",function(){b.removeClass(i.draggedClass),m.add(d).removeClass(i.droppableClass)}).on("selectstart.itemListComposer",function(){return this.dragDrop(),!1}),m.add(d).on("dragleave.itemListComposer",function(t){L&&L!==t.target||(e(this).removeClass(i.droppableClass),a(e(this))),L=null}).on("dragenter.itemListComposer",function(t){t.preventDefault(),L=t.target;var s=c(b.first());if(L===this&&e(this).is(i.itemReceiver)){var r=e(this).find(i.item).last();!r.hasClass(i.acceptorClass)&&i.itemReceiverOrderable&&(a(e(this)),r.after(n()))}(s.is(i.itemReceiver)||e(this).is(i.itemReceiver))&&e(this).addClass(i.droppableClass)}).on("dragover.itemListComposer",function(e){e.preventDefault()}).on("drop.itemListComposer",function(s){if(s.preventDefault(),b.removeClass(i.draggedClass),m.add(d).removeClass(i.droppableClass),!(e(this).is(i.itemSource)&&c(b.first()).is(i.itemSource)||e(this).is(i.itemReceiver)&&c(b.first()).is(i.itemReceiver)&&!i.itemReceiverOrderable)){var r=e(this).find("."+i.acceptorClass);t(b,e(this)),e(this).is(i.itemReceiver)&&i.itemReceiverOrderable?r.replaceWith(b):a(d)}}),f.on("click.itemListComposer",function(){var e=d.find(i.item+"."+i.selectedClass);t(e,m)}),p.on("click.itemListComposer",function(){var e=d.find(i.item);t(e,m)}),C.on("click.itemListComposer",function(){var e=m.find(i.item+"."+i.selectedClass);t(e,d)}),h.on("click.itemListComposer",function(){var e=m.find(i.item);t(e,d)}),i.itemReceiverOrderable&&(u.on("click.itemListComposer",function(){m.find(i.item+"."+i.selectedClass).each(function(){s(e(this))})}),v.on("click.itemListComposer",function(){e(m.find(i.item+"."+i.selectedClass).get().reverse()).each(function(){r(e(this))})}))})}}(jQuery);