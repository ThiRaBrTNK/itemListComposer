!function(e){e.fn.itemListComposer=function(t){var s=e.extend({itemSource:".source",itemReceiver:".receiver",item:"li",selectitem:".select",selectAllitems:".select-all",deselectitem:".deselect",deselectAllitems:".deselect-all",shiftUpButton:".order-up",shiftDownButton:".order-down",acceptorTemplate:"#acceptor",acceptorClass:"acceptor",selectedClass:"selected",draggedClass:"dragged"},t);return this.each(function(){function t(t,i,n){if("boolean"==typeof n&&n){var a=i.clone(!0);a.append(a.append(t).find(s.item).sort(function(t,s){return e(t).text().toUpperCase().localeCompare(e(s).text().toUpperCase())})),i.replaceWith(a)}else i.append(t);l=e(g).find(s.itemSource),o=e(g).find(s.itemReceiver)}function i(t){var i=e(t).prev();i.hasClass(s.selectedClass)||i.before(t)}function n(t){var i=e(t).next();i.hasClass(s.selectedClass)||i.after(t)}function a(){o.find("."+s.acceptorClass).remove()}function r(){return C.clone()}var c,l=e(this).find(s.itemSource),o=e(this).find(s.itemReceiver),d=e(this).find(s.selectitem),f=e(this).find(s.selectAllitems),h=e(this).find(s.deselectitem),u=e(this).find(s.deselectAllitems),p=e(this).find(s.shiftUpButton),v=e(this).find(s.shiftDownButton),C=e(e(this).find(s.acceptorTemplate).get(0).content),g=this,m=null,x=e([]);sourceItemBehavior={};var k={dragover:function(t){t.preventDefault();var i=t.originalEvent.offsetY;console.log(t.originalEvent.pageX),i<=e(this).outerHeight()/2&&!e(this).prev().hasClass(s.acceptorClass)?(a(),e(this).before(r())):i>e(this).outerHeight()/2&&!e(this).next().hasClass(s.acceptorClass)&&(a(),e(this).after(r()))}};l.append(l.find(s.item).sort(function(t,s){return e(t).text().toUpperCase().localeCompare(e(s).text().toUpperCase())})),o.find(s.item).each(function(){for(var t in k)k.hasOwnProperty(t)&&e(this).on(t,k[t])});var D=o[0];["dragstart","drag","dragenter","dragleave","dragover","drop","dragend"].forEach(function(e){D.addEventListener(e,function(t){console.log(e,t.target)})}),l.add(o).find(s.item).click(function(t){if(t.shiftKey&&void 0!=c){var i=Math.min(e(this).index(),c.index()),n=Math.max(e(this).index(),c.index()),a=e(this).siblings().slice(i,n);a.add(this).addClass(s.selectedClass)}else e(this).toggleClass(s.selectedClass);c=e(this)}).on("dragstart",function(t){var i=e(this).parents(s.itemSource);i.length||(i=e(this).parents(s.itemReceiver)),x=i.find("."+s.selectedClass),x.addClass(s.draggedClass),t.originalEvent.dataTransfer.setData("text/plain","Dragndrop now works in stinky bastard FF")}).on("dragend",function(){x.removeClass(s.draggedClass)}),o.on("dragleave",function(t){(!m||t.target===this&&!e(m).hasClass(s.acceptorClass))&&a(),m=null}).on("dragenter",function(t){if(m=t.target,t.target===this){var i=e(this).find(s.item).last();i.hasClass(s.acceptorClass)||i.after(r())}}).on("dragover",function(e){e.preventDefault()}).on("drop",function(t){t.preventDefault();var i=e(this).find("."+s.acceptorClass);console.log(i),i.replaceWith(x)}),d.click(function(){var e=l.find(s.item+"."+s.selectedClass);t(e,o)}),f.click(function(){var e=l.find(s.item);e.addClass(s.selectedClass),t(e,o)}),h.click(function(){var e=o.find(s.item+"."+s.selectedClass);t(e,l,!0)}),u.click(function(){var e=o.find(s.item);e.addClass(s.selectedClass),t(e,l,!0)}),p.click(function(){o.find(s.item+"."+s.selectedClass).each(function(){i(e(this))})}),v.click(function(){e(o.find(s.item+"."+s.selectedClass).get().reverse()).each(function(){n(e(this))})})})}}(jQuery);
