!function(e){e.fn.itemListComposer=function(t){var s=e.extend({itemSource:".source",itemReceiver:".receiver",item:"li",selectItem:".select",selectAllitems:".select-all",deselectItem:".deselect",deselectAllitems:".deselect-all",shiftUpButton:".order-up",shiftDownButton:".order-down",acceptorTemplate:"#acceptor",acceptorClass:"acceptor",selectedClass:"selected",draggedClass:"dragged",droppableClass:"droppable"},t);return this.each(function(){function t(t,i){if(i.is(s.itemSource)){var a=i.clone(!0);a.append(a.append(t).find(s.item).sort(function(t,s){return e(t).text().toUpperCase().localeCompare(e(s).text().toUpperCase())})),i.replaceWith(a),l(t)}else i.append(t),l(t);d=e(x).find(s.itemSource),f=e(x).find(s.itemReceiver)}function i(t){var i=e(t).prev();i.hasClass(s.selectedClass)||i.before(t)}function a(t){var i=e(t).next();i.hasClass(s.selectedClass)||i.after(t)}function n(e){e.find("."+s.acceptorClass).remove()}function r(){return g.clone()}function l(t){t.each(function(){var t=R,i=D,a=e(this).parents(s.itemSource);a.length||(t=D,i=R);for(var n in t)e(this).off(n);for(var n in i)e(this).on(n,R[n])})}function c(e){var t=e.parents(s.itemSource);return t.length||(t=e.parents(s.itemReceiver)),t}var o,d=e(this).find(s.itemSource),f=e(this).find(s.itemReceiver),h=e(this).find(s.selectItem),p=e(this).find(s.selectAllitems),u=e(this).find(s.deselectItem),m=e(this).find(s.deselectAllitems),v=e(this).find(s.shiftUpButton),C=e(this).find(s.shiftDownButton),g=e(e(this).find(s.acceptorTemplate).get(0).content),x=this,b=null,k=e([]),D={},R={dragover:function(t){t.preventDefault();var i=t.originalEvent.pageY-e(this).offset().top,a=e(this).outerHeight()/2;a>=i&&!e(this).prev().hasClass(s.acceptorClass)?(n(f),e(this).before(r())):i>a&&!e(this).next().hasClass(s.acceptorClass)&&(n(f),e(this).after(r()))}};d.append(d.find(s.item).sort(function(t,s){return e(t).text().toUpperCase().localeCompare(e(s).text().toUpperCase())})),l(f.find(s.item)),d.add(f).find(s.item).click(function(t){if(t.shiftKey&&void 0!=o){var i=Math.min(e(this).index(),o.index()),a=Math.max(e(this).index(),o.index()),n=e(this).siblings().slice(i,a);n.add(this).addClass(s.selectedClass)}else e(this).toggleClass(s.selectedClass);o=e(this)}).on("dragstart",function(t){var i=c(e(this));k=i.find("."+s.selectedClass).add(e(this)),k.addClass(s.draggedClass+" "+s.selectedClass),t.originalEvent.dataTransfer.setData("text/plain","Dragndrop now works in stinky bastard FF")}).on("dragend",function(){k.removeClass(s.draggedClass),f.add(d).removeClass(s.droppableClass)}).on("selectstart",function(){return this.dragDrop(),!1}),f.add(d).on("dragleave",function(t){b&&b!==t.target||(e(this).removeClass(s.droppableClass),n(e(this))),b=null}).on("dragenter",function(t){t.preventDefault(),b=t.target;var i=c(k.first());if(b===this&&e(this).is(s.itemReceiver)){var a=e(this).find(s.item).last();a.hasClass(s.acceptorClass)||(n(e(this)),a.after(r()))}(i.is(s.itemReceiver)||e(this).is(s.itemReceiver))&&e(this).addClass(s.droppableClass)}).on("dragover",function(e){e.preventDefault()}).on("drop",function(i){if(i.preventDefault(),k.removeClass(s.draggedClass),f.add(d).removeClass(s.droppableClass),e(this).is(s.itemSource)&&c(k.first()).is(s.itemSource))return n(e(this)),void 0;var a=e(this).find("."+s.acceptorClass);t(k,e(this)),e(this).is(s.itemReceiver)?a.replaceWith(k):n(d)}),h.click(function(){var e=d.find(s.item+"."+s.selectedClass);t(e,f)}),p.click(function(){var e=d.find(s.item);t(e,f)}),u.click(function(){var e=f.find(s.item+"."+s.selectedClass);t(e,d)}),m.click(function(){var e=f.find(s.item);t(e,d)}),v.click(function(){f.find(s.item+"."+s.selectedClass).each(function(){i(e(this))})}),C.click(function(){e(f.find(s.item+"."+s.selectedClass).get().reverse()).each(function(){a(e(this))})})})}}(jQuery);
